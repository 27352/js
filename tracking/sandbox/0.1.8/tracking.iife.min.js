!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;((e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).vtg||(e.vtg={})).tracking=t()}}(function(){return function o(r,s,d){function c(e,t){if(!s[e]){if(!r[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(p)return p(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var a=s[e]={exports:{}};r[e][0].call(a.exports,function(t){return c(r[e][1][t]||t)},a,a.exports,o,r,s,d)}return s[e].exports}for(var p="function"==typeof require&&require,t=0;t<d.length;t++)c(d[t]);return c}({1:[function(t,e,n){"use strict";var i,a=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__decorate||function(t,e,n,i){var a,o=arguments.length,r=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;0<=s;s--)(a=t[s])&&(r=(o<3?a(r):3<o?a(e,n,r):a(e,n))||r);return 3<o&&r&&Object.defineProperty(e,n,r),r};function r(n){return function(t,e){t.keys||(t.keys={}),t.keys[e]=function(t){return t.hasOwnProperty(e)&&t[e]?t[e]:"boolean"!=typeof n?n||"":n}}}function s(n){return function(t,e){t.rule||(t.rule={}),t.rule[e]=n.bind(t)}}Object.defineProperty(n,"__esModule",{value:!0}),n.ModuleParam=r,n.Rule=s;var d=function(){function t(t){this.data=t,this.format()}return t.prototype.format=function(){var e=this,n=this;return Object.keys(this.keys).forEach(function(t){n[t]=e.keys[t](e.data)}),n},t.prototype.dataToString=function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&null!==t[n]&&(e[n]=t[n].toString());return e},t}();function c(){return function(t){t.prototype.destroy=function(){var e=this;"function"==typeof this.onBeforeDestroy&&this.onBeforeDestroy(),Object.keys(this).forEach(function(t){"function"!=typeof e[t]&&(e[t]=null)})}}}function p(e){return function(t){t.prototype.injectable=e}}n.DataAccess=d,n.Destroyable=c,n.Injectable=p;var u=function(){function e(){}return e.setLogger=function(t){"object"==typeof t&&"function"==typeof t.log&&(e.logger=t)},e.isDebug=function(){return e.debug&&!!e.logger.log},e.debug=!1,e.logger=console||null,e}();n.Log=u;var h=function(){function t(){this.observers=[]}return t.prototype.register=function(t){"object"==typeof t&&(this.observers.unshift(t),t.onRegister())},t.prototype.remove=function(e){this.observers=this.observers.filter(function(t){return t!==e})},t.prototype.notify=function(t){for(var e=this.observers.length;e--;){var n=this.observers[e];n.onNotify.call(n,t)}},t}();n.Observable=h;var l=function(){function t(){this.items=[],this.isRunning=!1}return t.prototype.add=function(t){this.items.unshift(t)},t.prototype.forEach=function(t){if(!this.isRunning){this.isRunning=!0;for(var e=this.items.length;e--;){var n=this.items.pop();n&&t(n)}this.isRunning=!1}},t.prototype.isEmpty=function(){return 0===this.items.length},t}();n.Queue=l;var f=function(){function t(t){this.baseUrl=t,this.baseUrl=t.replace(/^\w*:/,"").replace(/^\/\//,"").replace(/\/*$/,"")}return t.prototype.request=function(t){return this.options=t,this},t.prototype.then=function(t){switch(this.options.method){case"POST":this.post(t);break;case"GET":this.get(t)}},t.prototype.post=function(t){if(XMLHttpRequest){var e=new XMLHttpRequest,n=[this.baseUrl,this.options.path].join("/");e.open("POST","//"+n,!0),e.setRequestHeader("Content-Type","application/json"),e.onreadystatechange=function(){e.readyState===XMLHttpRequest.DONE&&t({xmlHttpRequest:e,statusCode:e.status,message:200<=e.status&&e.status<300||304===e.status?"ok":e.statusText})},e.onerror=function(){t({xmlHttpRequest:e,statusCode:e.status,message:"error"})},e.send(g.stringify(this.options.data))}else this.xhrNotFound(t)},t.prototype.get=function(t){if(XMLHttpRequest){var e=new XMLHttpRequest,n=[this.baseUrl,this.options.path].join("/")+this.options.data;e.open("GET","//"+n,!0),e.send()}else this.xhrNotFound(t)},t.prototype.xhrNotFound=function(t){t({xmlHttpRequest:null,statusCode:-1,message:"XHR not supported"})},t}();n.RestClient=f;var g,y=function(){function t(t){this.milliseconds=t,this.isRunning=!1}return t.prototype.start=function(t){setInterval&&(this.isRunning||(this.intervalId=setInterval(t,this.milliseconds),this.isRunning=!0))},t.prototype.stop=function(){clearInterval&&(clearInterval(this.intervalId),this.isRunning=!1)},t}();n.Timer=y,function(t){function i(){return"object"==typeof window}function e(){return"object"==typeof top}function n(t){return i()&&window[t]}function a(){return e()&&-1<top.location.href.search(/^https/)}t.isWindow=i,t.isTop=e,t.isVar=function(t,e){var n=t.split(".");return 2===n.length?i()&&typeof window[n[0]]===e&&typeof window[n[0]][n[1]]===e:i()&&typeof window[t]===e},t.getVar=n,t.getScreenSize=function(){var t=window;return i()&&t.screen&&t.screen.width&&t.screen.height?t.screen.width+"x"+t.screen.height:"N/A"},t.isHttps=a,t.getProtocol=function(){return e()?a()?"https://":"http://":""},t.stringify=function(t){return n("JSON")?window.JSON.stringify(t):t.toString()}}(g=n.View||(n.View={}));var v=function(){function t(){this.vo=new S}return t.prototype.update=function(t){this.vo=this.mergeData(t),this.vo.timestamp=(new Date).getTime()},t.prototype.getData=function(){return this.vo},t.prototype.mergeData=function(t){var e=this.vo;for(var n in t)e.hasOwnProperty(n)&&void 0!==t[n]&&null!==t[n]&&(e[n]=this.vo.applyRule(n,t));return e},t}();n.DataVoProxy=v;var m=function(){function t(){}return t.toInt=function(t){return Math.floor(t)},t.toKbps=function(t){return Math.floor(t/1e3)},t.toLowercase=function(t){return t?t.toLocaleLowerCase():""},t}();n.DataRule=m;var S=function(){function t(){this.playerId="",this.playerName="",this.playerVersion="",this.playerInitTime=-1,this.playerManager={},this.dashJsPlayer={},this.hlsJsPlayer={},this.videoElement={},this.isMobile=!1,this.hasSessionResumed=!1,this.sessionId="",this.adBreakType="",this.adBreakPosition=-1,this.adBreakDuration=-1,this.adTitle="",this.adId="",this.adUrl="",this.adDuration=-1,this.adPosition=-1,this.mediaUrl="",this.category="",this.mediaId="",this.episodeTitle="",this.seriesTitle="",this.videoTitle="",this.airDate="",this.isPaidContent=!1,this.isAffiliateFeed=!1,this.duration=-1,this.episodeFlag=!1,this.isLive=!1,this.isDai=!1,this.timestamp=-1,this.playhead=0,this.season=NaN,this.episode=NaN,this.liveSegmentData={},this.cdn="",this.currentBitrate=-1,this.playbackFramerate=-1,this.drmEnabled=!1,this.drmType="",this.userId="",this.userStatus="anon",this.partner="",this.userCountry="",this.userConnectionType="",this.siteId="",this.contextData={},this.ozTamMediaId="",this.ozTamOptOut=!1,this.nielsenOptOut=!1,this.errorType=-1,this.errorMessage="",this.errorFatal=!1}return t.prototype.applyRule=function(t,e){return this.rule[t]?this.rule[t].call(this,e[t]):e[t]},o([s(m.toInt)],t.prototype,"adBreakDuration",void 0),o([s(m.toInt)],t.prototype,"adDuration",void 0),o([s(m.toInt)],t.prototype,"duration",void 0),o([s(m.toInt)],t.prototype,"playhead",void 0),o([s(m.toKbps)],t.prototype,"currentBitrate",void 0),o([s(m.toLowercase)],t.prototype,"userCountry",void 0),t}();n.DataVo=S;var k,b,E=function(){function t(t,e){this.config=t,this.observable=e,this.notifications=new l,this.isAdPlaying=!1,this.isSdkLoaded=!1,this.debugId="[Tracker] "+t.name}return t.prototype.onRegister=function(){u.isDebug()&&u.logger.log(this.debugId,"start up")},t.prototype.onNotify=function(t){var e=this;this.notifications.add(t),this.hasSdkLoaded()&&this.notifications.forEach(function(t){e.onNotificationReceived(t)})},t.prototype.hasSdkLoaded=function(){if("object"!=typeof this.injectable)return this.isSdkLoaded;var t=this.injectable,e=g.getVar(t.name);return e&&(this[t.name]=e,this.isSdkLoaded=!0),this.isSdkLoaded},t.prototype.onNotificationReceived=function(t){switch(u.isDebug()&&u.logger.log(this.debugId,t.name,this.getDataVo().playhead),(this.notification=t).name){case k.AdBreakStart:case k.AdStart:this.isAdPlaying=!0;break;case k.AdEnd:case k.AdBreakEnd:case k.ContentStart:this.isAdPlaying=!1}},t.prototype.getDataVo=function(){return this.observable.dataProxy.getData()},t.prototype.hasContentCompleted=function(){var t=this.getDataVo();return(!t||!t.isLive)&&t.playhead>=.95*t.duration},t}();n.Agent=E,(b=k=n.AppEvent||(n.AppEvent={})).AdBreakEnd="adBreakEnd",b.AdBreakStart="adBreakStart",b.AdClick="adClick",b.AdEnd="adEnd",b.AdError="adError",b.AdLoaded="adLoaded",b.AdPause="adPause",b.AdResume="adResume",b.AdSkip="adSkip",b.AdStart="adStart",b.Ad1stQt="ad1stQt",b.Ad2ndQt="ad2ndQt",b.Ad3rdQt="ad3rdQt",b.BitrateChange="bitrateChange",b.BufferEnd="bufferEnd",b.BufferStart="bufferStart",b.ContentEnd="contentEnd",b.ContentPause="contentPause",b.ContentResume="contentResume",b.ContentStart="contentStart",b.DashJsLoaded="dashJsLoaded",b.Heartbeat="hb",b.HlsJsLoaded="hlsJsLoaded",b.LiveSegmentStart="liveSegmentStart",b.LiveSegmentEnd="liveSegmentEnd",b.PlayerError="playerError",b.PlayerLoaded="playerLoaded",b.SeekEnd="seekEnd",b.SeekStart="seekStart",b.PlayheadUpdate="playheadUpdate",b.SessionEnd="sessionEnd",b.SessionStart="sessionStart";var A=function(){function t(){}return Object.defineProperty(t,"version",{get:function(){return"tracking v0.1.8 Tue, 20 Aug 2019 20:43:20 GMT"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"modules",{get:function(){return[I,L,R,O]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"applicationPlatform",{get:function(){return"Desktop"},enumerable:!0,configurable:!0}),t.isChromecast=function(){return"Chromecast"===t.applicationPlatform},t.isVizio=function(){return"Vizio"===t.applicationPlatform},t.isPs4=function(){return"Ps4"===t.applicationPlatform},t.isDev=function(){return!(!window.utag||!window.utag.data||"dev"!==window.utag.data["ut.env"])},t}();n.BuildInfo=A;var P=function(){function t(t){this.tracker=t,this.hasContentStart=!1,this.hasSessionEnd=!1,this.isStopped=!0,this.isAd=!1,this.config={name:"Hb",enabled:!0,params:{}},this.timer=new y(1e4)}return t.prototype.onRegister=function(){},t.prototype.onNotify=function(t){switch(t.name){case k.ContentStart:this.hasSessionEnd=!1,this.hasContentStart=!0;break;case k.AdBreakStart:this.isAd=!0,this.timer.stop();break;case k.AdBreakEnd:this.isAd=!1;break;case k.ContentPause:case k.BufferStart:case k.SeekStart:this.isStopped=!0,this.startHb();break;case k.PlayheadUpdate:this.onPlayheadUpdate();break;case k.ContentEnd:case k.SessionEnd:this.hasSessionEnd=!0,this.hasContentStart=!1,this.isStopped=!0,this.timer.stop()}},t.prototype.onPlayheadUpdate=function(){this.hasSessionEnd||this.isStopped&&this.hasContentStart&&!this.isAd&&(this.isStopped=!1,this.startHb())},t.prototype.startHb=function(){var t=this;this.timer.stop(),this.timer.start(function(){t.tracker.track(k.Heartbeat)})},t.NAME="Hb",t}();n.Heartbeat=P;var C=function(){function t(){}return t.prototype.register=function(i){var a=this;this.tracker=i,this.registerAgent(new P(i)),this.tracker.modules.forEach(function(t){var e=t;if(a.isAgentEnabled(e.NAME)){var n=a.getAgentConfig(e.NAME);a.registerAgent(new e(n,i))}})},t.prototype.update=function(n){var i=this,t=this.tracker.observers.filter(function(t){var e=t;return e.config&&e.config.name&&n[t.config.name]});for(var e in t.forEach(function(t){var e=t.config.name;n[e].enabled||i.tracker.remove(t)}),n){var a=n[e];this.tracker.config[e]=a}this.register(this.tracker)},t.prototype.isAgentEnabled=function(t){return this.tracker.config.hasOwnProperty(t)&&this.tracker.config[t].hasOwnProperty("enabled")&&this.tracker.config[t].enabled},t.prototype.getAgentConfig=function(t){var e=this.tracker.config[t];return e.params||(e.params={}),e.name||(e.name=t),e},t.prototype.registerAgent=function(e){!!this.tracker.observers.find(function(t){return t.config.name===e.config.name})||this.tracker.register(e)},t}();n.Registrar=C;var D=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.dataProxy=new v,t.registrar=new C,t.modules=A.modules,t}return a(t,n),t.prototype.track=function(t,e){this.dataProxy.update(e||{}),n.prototype.notify.call(this,{name:t})},t.prototype.setConfig=function(t){this.setDebug(A.isDev()),this.config?this.registrar.update(t):(this.config=t,this.registrar.register(this))},t.prototype.setContextData=function(t){this.dataProxy.update({contextData:t})},t.prototype.setLiveSegmentData=function(t){this.dataProxy.update({liveSegmentData:t})},t.prototype.setDebug=function(t){u.debug=t,u.isDebug()&&u.logger.log(A.version)},t.prototype.setLogger=function(t){u.setLogger(t)},t}(h),T=function(i){function t(){var t=null!==i&&i.apply(this,arguments)||this;return t.hasContentStart=!1,t.hasBufferStart=!1,t.isSeeking=!1,t.playhead=0,t.eventMap={resourceStart:function(){"object"==typeof t.model.resource.uvpc&&t.setConfig(t.model.resource.uvpc),t.trackSessionStart()},adBreakStart:t.trackAdBreakStart,adStart:t.trackAdStart,adPaused:function(){t.trackEvent(k.AdPause)},adPlaying:function(){t.trackEvent(k.AdResume)},adComplete:function(){t.trackEvent(k.AdEnd)},adBreakEnd:function(){t.trackEvent(k.AdBreakEnd)},adFirstQuartile:function(){t.trackEvent(k.Ad1stQt)},adMidpoint:function(){t.trackEvent(k.Ad2ndQt)},adThirdQuartile:function(){t.trackEvent(k.Ad3rdQt)},contentBitrateChanged:function(){t.trackEvent(k.BitrateChange,{currentBitrate:t.model.collection.ContentPlaybackState.playbackBitrate})},contentStart:function(){t.hasContentStart=!0,t.trackContentStart()},contentTimeupdate:t.trackTimeUpdate,contentPaused:function(){t.trackEvent(k.ContentPause)},contentPlaying:function(){t.trackEvent(k.ContentResume)},contentSeeking:function(){t.isSeeking=!0,t.trackEvent(k.SeekStart)},contentSeeked:function(){t.isSeeking=!1,t.trackEvent(k.SeekEnd)},contentBuffering:function(){t.hasBufferStart=!0,t.trackEvent(k.BufferStart)},contentEnd:t.trackContentEnd,resourceEnd:t.trackSessionEnd,resourceError:t.trackResourceError,hb:function(){t.isAd()||t.trackEvent(k.Heartbeat)}},t}return a(t,i),t.prototype.setModel=function(t){(this.model=t).resource&&t.resource.contextMetadata&&i.prototype.setContextData.call(this,this.model.resource.contextMetadata)},t.prototype.registerUvpc=function(t){this.setConfig(t)},t.prototype.track=function(t,e){var n=this.eventMap[t];n&&n.call(this,e)},t.prototype.trackResourceError=function(t){this.trackEvent(k.PlayerError,{errorType:t.status||NaN,errorMessage:t.message||"",errorFatal:t.isFatal||!1})},t.prototype.trackSessionStart=function(){var t=this.model.collection.BuildInfo,e=this.model.collection.ContentPlaybackState.playheadTime,n=this.model.system,i=this.model.resource,a=this.model.collection;this.trackEvent(k.SessionStart,{playerName:t.playerName,playerVersion:t.playerVersion,playerId:a&&a.PlayerOptions.id?a.PlayerOptions.id:"",sessionId:a&&a.PlayerOptions.sessionId?a.PlayerOptions.sessionId:(new Date).getTime(),playhead:e,hasSessionResumed:0<e,userId:a&&a.PlayerOptions.userId?a.PlayerOptions.userId:"",partner:i&&i.adSettings.tracking.partner?i.adSettings.tracking.partner:"",userCountry:"us",drmEnabled:i&&i.resourceLocation.drm.enabled,userConnectionType:n&&n.device?n.device:"",isMobile:n&&n.isMobile,isPaidContent:i&&i.contentMetadata.isPaidContent,isAffiliateFeed:i&&i.contentMetadata.isAffiliateFeed})},t.prototype.trackAdBreakStart=function(){var t=this.model.collection.AdBreakInfo;this.trackEvent(k.AdBreakStart,{adBreakType:t.adBreakType,adBreakPosition:t.adBreakPosition,adBreakDuration:t.adBreakDuration,playhead:this.model.collection.ContentPlaybackState.playheadTime})},t.prototype.trackAdStart=function(){var t=this.model.collection.AdItem;this.trackEvent(k.AdStart,{adId:t.adId||"",adTitle:t.adTitle||"",adAssetUrl:t.adAssetUrl||"",adPosition:t.adPosition,adDuration:t.adDuration,playhead:this.model.collection.ContentPlaybackState.playheadTime})},t.prototype.trackContentStart=function(){var t=this.model.resource;this.trackEvent(k.ContentStart,{mediaUrl:t.resourceLocation.mediaUrl||"",mediaId:t.contentMetadata.videoIdForTracking||"",duration:this.model.collection.ContentPlaybackState.duration||-1,videoTitle:t.contentMetadata.videoTitle||"",seriesTitle:t.contentMetadata.seriesTitle||"",season:t.contentMetadata.seasonNumber||"",episode:t.contentMetadata.episodeNumber||"",category:t.contentMetadata.category||"",isLive:this.isLive(),episodeFlag:t.contentMetadata.episodeFlag,ozTamMediaId:t.tracking.oztamMediaId||"",ozTamOptOut:!1})},t.prototype.trackTimeUpdate=function(){if(!this.isSeeking&&!this.isAd()&&this.hasContentStart){var t=Math.floor(this.model.collection.ContentPlaybackState.playheadTime);t!==this.playhead&&(this.playhead=t,this.hasBufferStart&&(this.hasBufferStart=!1,this.trackEvent(k.BufferEnd)),this.trackEvent(k.PlayheadUpdate))}},t.prototype.trackContentEnd=function(){this.hasContentStart&&this.trackEvent(k.ContentEnd)},t.prototype.trackSessionEnd=function(){this.trackEvent(k.SessionEnd)},t.prototype.trackEvent=function(t,e){var n=e||{};n.hasOwnProperty("playhead")||(n.playhead=this.playhead),this.isAd()&&(n.playhead=this.model.collection.ContentPlaybackState.playheadTime),i.prototype.track.call(this,t,n)},t.prototype.isLive=function(){var t=this.model.resource.contentMetadata.streamType;return!(!t||"LIVE"!==t.toLocaleUpperCase())},t.prototype.isModelDefined=function(){return this.model&&"object"==typeof this.model.collection},t.prototype.isAd=function(){return this.model.collection.PresentationState.isCurrentVideoAd},t}(n.Tracker=D);n.CvTracker=T;var I=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hasAdobeSession=!1,t.isStopped=!1,t.isSdkLoaded=!0,t}return a(t,e),t.prototype.onRegister=function(){e.prototype.onRegister.call(this),this.vo=new _(this),this.restClient=new f(u.isDebug()?this.vo.devApiServer:this.vo.prodApiServer),this.eventQueue=new l},t.prototype.onNotificationReceived=function(t){switch(e.prototype.onNotificationReceived.call(this,t),t.name){case k.AdBreakStart:this.trackEvent("adBreakStart");break;case k.AdStart:this.trackEvent("adStart");break;case k.AdClick:case k.AdPause:this.trackEvent("pauseStart");break;case k.AdEnd:this.trackEvent("adComplete");break;case k.AdBreakEnd:this.trackEvent("adBreakComplete");break;case k.ContentStart:this.hasAdobeSession||this.requestAdobeSession(),this.trackEvent("play");break;case k.ContentPause:this.isStopped=!0,this.trackEvent("pauseStart");break;case k.BufferStart:this.isStopped=!0,this.trackEvent("bufferStart");break;case k.SeekStart:this.isStopped=!0;break;case k.ContentResume:case k.PlayheadUpdate:this.isStopped&&(this.isStopped=!1,this.trackEvent("play"));break;case k.Heartbeat:case k.Ad1stQt:case k.Ad2ndQt:case k.Ad3rdQt:this.trackEvent("ping");break;case k.SessionEnd:this.trackSessionEnd()}},t.prototype.trackEvent=function(t){this.eventQueue.add(t),this.processEventQueue()},t.prototype.processEventQueue=function(){var e=this;this.hasAdobeSession&&this.eventQueue.forEach(function(t){e.sendTrackRequest(t)})},t.prototype.sendTrackRequest=function(t){if("play"!==t||!this.isAdPlaying){var e={path:this.apiPath,data:this.vo.getPayload(t),method:"POST"};u.isDebug()&&u.logger.log(this.debugId,t,e),this.restClient.request(e).then(function(t){})}},t.prototype.requestAdobeSession=function(){var n=this,t={path:_.SESSION_PATH,data:this.vo.getSessionStartData(),method:"POST"};u.isDebug()&&u.logger.log(this.debugId,t),this.restClient.request(t).then(function(t){if(404===t.statusCode)throw"Error: Server response 404";var e=t.xmlHttpRequest.getResponseHeader("location");if(!e)throw"Error: Location not found";n.hasAdobeSession=!0,n.apiPath=n.vo.getApiPath(e),u.isDebug()&&u.logger.log(n.debugId,n.apiPath),n.processEventQueue()})},t.prototype.trackSessionEnd=function(){this.hasContentCompleted()&&this.trackEvent("sessionComplete"),this.trackEvent("sessionEnd"),this.hasAdobeSession=!1},t.NAME="Adobe",t=o([c()],t)}(E);n.AdobeAgent=I;var _=function(n){function t(t){var e=n.call(this,t.config.params)||this;return e.agent=t,e}var i;return a(t,n),(i=t).prototype.getSessionStartData=function(){var t=this.agent.getDataVo(),e=this.getPayload("sessionStart");return e.params={"analytics.trackingServer":this.trackingServer,"analytics.reportSuite":this.reportSuite,"analytics.visitorId":this.visitorId,"analytics.enableSSL":this.enableSSL,"visitor.marketingCloudOrgId":this.marketingCloudOrgId,"visitor.marketingCloudUserId":this.getMarketingCloudUserId(),"media.playerName":t.playerName,"media.contentType":t.isLive?"Live":"VOD","media.length":t.isLive?i.LIVE_CONTENT_LENGTH:t.duration,"media.id":t.mediaId,"media.name":t.videoTitle,"media.channel":this.channel,"media.sdkVersion":t.playerVersion&&t.playerVersion.toString(),"media.network":this.channel,"media.showType":t.episodeFlag?"0":"2","media.resume":!!t.hasSessionResumed},t.seriesTitle&&(e.params["media.show"]=t.seriesTitle),t.category&&(e.params["media.genre"]=t.category),t.season&&(e.params["media.season"]=t.season.toString()),t.episode&&(e.params["media.episode"]=t.episode.toString()),t.contextData.mediaResume=t.hasSessionResumed?"true":"false",e.customMetadata=this.dataToString(t.contextData),e},t.prototype.getMarketingCloudUserId=function(){if(this.marketingCloudUserId)return this.marketingCloudUserId;var t=g.getVar("Visitor");if(!t)return"";var e=t.getInstance(this.marketingCloudOrgId,this.visitorOptions||{});return e&&e.getMarketingCloudVisitorID?e.getMarketingCloudVisitorID():""},t.prototype.getAdBreakStartData=function(){var t=this.agent.getDataVo();return{"media.ad.podFriendlyName":t.adBreakType,"media.ad.podIndex":t.adBreakPosition,"media.ad.podSecond":t.playhead}},t.prototype.getAdItemData=function(){var t=this.agent.getDataVo();return{"media.ad.name":t.adTitle,"media.ad.id":t.videoTitle+" - "+t.adTitle,"media.ad.length":t.adDuration,"media.ad.creativeId":t.adId,"media.ad.creativeURL":t.adUrl,"media.ad.playerName":t.playerName,"media.ad.podPosition":t.adPosition}},t.prototype.getApiPath=function(t){return[t=t.replace(/^\/|\/$/g,""),"events"].join("/")},t.prototype.getPayload=function(t){var e=this.agent.getDataVo(),n={};switch(t){case"adBreakStart":n=this.getAdBreakStartData();break;case"adStart":n=this.getAdItemData()}return{eventType:t,playerTime:{playhead:e.playhead,ts:(new Date).getTime()},params:n}},t.SESSION_PATH="api/v1/sessions",t.LIVE_CONTENT_LENGTH=86400,o([r(!1)],t.prototype,"enableSSL",void 0),o([r()],t.prototype,"channel",void 0),o([r()],t.prototype,"reportSuite",void 0),o([r()],t.prototype,"trackingServer",void 0),o([r()],t.prototype,"marketingCloudOrgId",void 0),o([r()],t.prototype,"marketingCloudUserId",void 0),o([r()],t.prototype,"visitorId",void 0),o([r()],t.prototype,"devApiServer",void 0),o([r()],t.prototype,"prodApiServer",void 0),o([r()],t.prototype,"visitorOptions",void 0),t=i=o([c()],t)}(d);n.AdobeVo=_;var L=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isPaused=!1,t.hasSessionStart=!1,t.isSdkLoaded=!0,t}return a(t,e),t.prototype.onRegister=function(){e.prototype.onRegister.call(this),this.vo=new w(this),this.restClient=new f(u.isDebug()?this.vo.devApiServer:this.vo.prodApiServer)},t.prototype.onNotificationReceived=function(t){switch(e.prototype.onNotificationReceived.call(this,t),t.name){case k.SessionStart:this.apiPath=this.vo.getApiPath(),this.hasSessionStart=!0;break;case k.AdStart:case k.ContentStart:this.trackEvent("playhead");break;case k.ContentPause:case k.BufferStart:case k.SeekStart:case k.PlayerError:this.trackContentStop();break;case k.ContentResume:case k.PlayheadUpdate:this.trackContentProgress();break;case k.Heartbeat:!this.isPaused&&this.trackEvent("playhead");break;case k.SessionEnd:this.trackSessionEnd(),this.hasSessionStart=!1}},t.prototype.trackContentStop=function(){this.trackEvent("playhead"),this.isPaused=!0},t.prototype.trackContentProgress=function(){this.isPaused&&(this.trackEvent("playhead"),this.isPaused=!1)},t.prototype.trackSessionEnd=function(){this.trackEvent("playhead"),this.hasContentCompleted()&&this.trackEvent("complete"),this.trackEvent("delete")},t.prototype.trackEvent=function(t){if(this.hasSessionStart){var e={path:this.apiPath,data:this.vo.getPayload(t),method:"GET"};u.isDebug()&&u.logger.log(this.debugId,t,e),this.restClient.request(e).then(function(t){})}},t.NAME="Nielsen",t}(E);n.NielsenAgent=L;var w=function(n){function t(t){var e=n.call(this,t.config.params)||this;return e.agent=t,e}var i;return a(t,n),(i=t).prototype.getApiPath=function(){return[this.appId,this.agent.getDataVo().sessionId,"a?b="].join("/")},t.prototype.getPayload=function(t){var e=this.getEventInfo(t);return e.devInfo=this.getDeviceInfo(),e.metadata={static:this.dataToString(this.agent.getDataVo().contextData),content:this.dataToString(this.getContentInfo()),ad:this.dataToString(this.getAdInfo())},g.stringify(e)},t.prototype.getDeviceInfo=function(){var t=this.agent.getDataVo();return{devId:t.userId,apn:t.playerName,apv:t.playerVersion,uoo:t.nielsenOptOut.toString()}},t.prototype.getContentInfo=function(){var t=this.agent.getDataVo(),e=t.isLive?i.LINEAR_AD_TYPE:i.DYNAMIC_AD_TYPE;return t.isDai&&(e=i.DYNAMIC_AD_TYPE),{type:"content",assetid:t.mediaId,program:t.seriesTitle,title:t.videoTitle,length:t.duration,airdate:t.airDate,isfullepisode:t.episodeFlag?"y":"n",crossId1:t.mediaId,adloadtype:e,adModel:e,hasAds:t.adBreakType?i.LINEAR_AD_TYPE:i.ADS_NOT_INCLUDED,progen:this.genreId}},t.prototype.getAdInfo=function(){var t=this.agent.getDataVo();return{assetid:t.adId,type:t.adBreakType}},t.prototype.getEventInfo=function(t){var e=this.agent.getDataVo();return{event:t,position:e.playhead.toString(),type:this.agent.isAdPlaying?"ad":"content",utc:e.timestamp.toString()}},t.ADS_NOT_INCLUDED=0,t.LINEAR_AD_TYPE=1,t.DYNAMIC_AD_TYPE=2,o([r()],t.prototype,"appId",void 0),o([r()],t.prototype,"devApiServer",void 0),o([r()],t.prototype,"prodApiServer",void 0),o([r()],t.prototype,"genreId",void 0),o([r(10)],t.prototype,"hbInterval",void 0),t=i=o([c()],t)}(d);n.NielsenVo=w;var R=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isSdkLoaded=!0,t}return a(t,e),t.prototype.onRegister=function(){e.prototype.onRegister.call(this),this.vo=new N(this)},t.prototype.onNotificationReceived=function(t){switch(e.prototype.onNotificationReceived.call(this,t),t.name){case k.PlayheadUpdate:this.vo.shouldTrackEvent()&&this.trackEvent()}},t.prototype.trackEvent=function(){var t=u.isDebug()?this.vo.stageUrl:this.vo.prodUrl;new f(t).request({path:N.PATH,data:this.vo.getQueryString(),method:"GET"}).then(Function.prototype)},t.NAME="Sparrow",t}(E);n.SparrowAgent=R;var N=function(n){function e(t){var e=n.call(this,t.config.params)||this;return e.agent=t,e}return a(e,n),e.prototype.getQueryString=function(){var t=this.agent.getDataVo();return["ts="+Math.floor(t.timestamp/1e3),"contentid="+t.mediaId,"userid="+(t.userId||e.USER_ID),"siteid="+(t.siteId||e.SITE_ID),"sessionid="+t.sessionId,"platform="+(t.isMobile?e.MOBILE:e.DESKTOP),"premium="+t.isPaidContent,"affiliate="+t.isAffiliateFeed,"medtime="+t.playhead].join("&")},e.prototype.shouldTrackEvent=function(){var t=this.agent.getDataVo();return t.playhead%this.interval==0&&(t.episodeFlag||t.isLive)},e.PATH="streamer/v1.0/ingest/beacon.json?",e.SITE_ID=164,e.USER_ID=-1,e.DESKTOP="desktop",e.MOBILE="mobile_web",o([r("sparrow.cbs.com")],e.prototype,"prodUrl",void 0),o([r("stage-sparrow.cbs.com")],e.prototype,"stageUrl",void 0),o([r(10)],e.prototype,"interval",void 0),e}(d);n.SparrowVo=N;var O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hasContentStart=!1,t.isStopped=!1,t}return a(t,e),t.prototype.onRegister=function(){e.prototype.onRegister.call(this),this.vo=new M(this)},t.prototype.onNotificationReceived=function(t){switch(e.prototype.onNotificationReceived.call(this,t),t.name){case k.SessionStart:this.createStreamingTag();break;case k.AdStart:case k.AdResume:this.trackAdPlay(),this.isStopped=!1;break;case k.ContentStart:case k.ContentResume:this.trackContentPlay(),this.isStopped=!1;break;case k.LiveSegmentStart:this.trackStop(),this.vo.isSameLiveStation()||this.createStreamingTag(),this.trackContentPlay();break;case k.PlayheadUpdate:this.isStopped&&(this.trackContentPlay(),this.isStopped=!1);break;case k.AdClick:case k.AdEnd:case k.AdPause:case k.ContentEnd:case k.ContentPause:case k.SeekStart:case k.SessionEnd:case k.LiveSegmentEnd:this.isStopped=!0,this.trackStop()}},t.prototype.createStreamingTag=function(){this.streamingTag=new this.ns_.ReducedRequirementsStreamingAnalytics(this.vo.getComscoreConfig())},t.prototype.trackAdPlay=function(){this.streamingTag&&this.streamingTag.playVideoAdvertisement(this.vo.getAdMetadata(),this.vo.getAdType())},t.prototype.trackContentPlay=function(){this.streamingTag&&this.streamingTag.playVideoContentPart(this.vo.getContentMetadata(),this.vo.getContentType())},t.prototype.trackStop=function(){this.streamingTag&&this.streamingTag.stop()},t.NAME="Comscore",t=o([p({name:"ns_",type:"object"}),c()],t)}(E);n.ComscoreAgent=O;var M=function(n){function t(t){var e=n.call(this,t.config.params)||this;return e.agent=t,e}var d;return a(t,n),(d=t).prototype.getComscoreConfig=function(){return{publisherId:this.c2,ns_st_pu:this.agent.getDataVo().partner}},t.prototype.getAdMetadata=function(){return{ns_st_cl:this.agent.getDataVo().adDuration}},t.prototype.getAdType=function(){var t=this.agent.getDataVo(),e=this.agent.ns_.ReducedRequirementsStreamingAnalytics.AdType,n=t.adId.split("_")[0];return t.isLive?e.LinearLive:"pre"===n?e.LinearOnDemandPreRoll:"mid"===n?e.LinearOnDemandMidRoll:e.LinearOnDemandPostRoll},t.prototype.getContentMetadata=function(){var t=this.agent.getDataVo(),e=t.videoTitle.split("-"),n=0<e.length?e[1]:t.videoTitle,i=d.NULL,a=d.NULL,o=t.videoTitle,r=t.contextData.comscore_c4||"";isNaN(t.season)||isNaN(t.episode)||(o+="--"+(i=this.padSingleDigitWithZero(t.season))+(a=this.padSingleDigitWithZero(t.episode)));var s={ns_st_ci:t.mediaId,ns_st_cl:t.duration,ns_st_pu:t.partner,ns_st_pr:t.seriesTitle||t.videoTitle,ns_st_ep:n,ns_st_sn:i,ns_st_en:a,ns_st_ge:t.category||d.NULL,ns_st_ia:t.isLive?1:0,ns_st_ddt:d.NULL,ns_st_tdt:d.NULL,ns_st_st:this.c4||d.NULL,ns_st_ce:t.episodeFlag?1:0,c3:t.playerName,c4:r||this.c4,c6:o};return t.isLive&&(s=this.mergeLiveSegmentData(s)),s},t.prototype.getContentType=function(){var t=this.agent.ns_.ReducedRequirementsStreamingAnalytics.ContentType;return this.agent.getDataVo().isLive?t.Live:t.LongFormOnDemand},t.prototype.mergeLiveSegmentData=function(e){var n=this.agent.getDataVo().liveSegmentData;return Object.keys({publisherBrand:"ns_st_pu",programTitle:"ns_st_pr",episodeTitle:"ns_st_ep",seasonNumber:"ns_st_sn",episodeNumber:"ns_st_en",stationTitle:"ns_st_st",clipLength:"ns_st_cl",contentGenre:"ns_st_ge",tmsGracenoteId:"ns_st_ti",episodeId:"ns_st_tep",adLoadFlag:"ns_st_ia",fullEpisodeFlag:"ns_st_ce",digitalAirDate:"ns_st_ddt",tvAirDate:"ns_st_tdt"}).forEach(function(t){n.hasOwnProperty(t)&&n[t]&&(e[t]=n[t])}),e},t.prototype.isSameLiveStation=function(){var t=this.agent.getDataVo().liveSegmentData,e=this.c4||d.NULL;return t.stationTitle&&t.stationTitle===e},t.prototype.padSingleDigitWithZero=function(t){return(0<t&&t<10?"0":"")+t.toString()},t.NULL="*null",o([r("3005086")],t.prototype,"c2",void 0),o([r()],t.prototype,"c3",void 0),o([r()],t.prototype,"c4",void 0),o([r()],t.prototype,"publishersSecret",void 0),t=d=o([c()],t)}(d);n.ComscoreVo=M},{}]},{},[1])(1)});