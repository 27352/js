!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;((e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).vtg||(e.vtg={})).tracking=t()}}(function(){return function r(a,s,d){function h(e,t){if(!s[e]){if(!a[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(c)return c(e,!0);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}var i=s[e]={exports:{}};a[e][0].call(i.exports,function(t){return h(a[e][1][t]||t)},i,i.exports,r,a,s,d)}return s[e].exports}for(var c="function"==typeof require&&require,t=0;t<d.length;t++)h(d[t]);return h}({1:[function(t,e,n){"use strict";var o,i=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),r=this&&this.__decorate||function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;0<=s;s--)(i=t[s])&&(a=(r<3?i(a):3<r?i(e,n,a):i(e,n))||a);return 3<r&&a&&Object.defineProperty(e,n,a),a};function a(n){return function(t,e){t.keys||(t.keys={}),t.keys[e]=function(t){return t.hasOwnProperty(e)&&t[e]?t[e]:"boolean"!=typeof n?n||"":n}}}Object.defineProperty(n,"__esModule",{value:!0}),n.ModuleParam=a;var s=function(){function t(t){this.data=t,this.format()}return t.prototype.format=function(){var e=this,n=this;return Object.keys(this.keys).forEach(function(t){n[t]=e.keys[t](e.data)}),n},t.prototype.dataToString=function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n].toString());return e},t}();function d(){return function(t){t.prototype.destroy=function(){var e=this;"function"==typeof this.onBeforeDestroy&&this.onBeforeDestroy(),Object.keys(this).forEach(function(t){"function"!=typeof e[t]&&(e[t]=null)})}}}n.DataAccess=s,n.Destroyable=d,n.Injectable=function(e){return function(t){t.prototype.injectable=e}};var h=function(){function e(){}return e.setLogger=function(t){"object"==typeof t&&"function"==typeof t.log&&(e.logger=t)},e.isDebug=function(){return e.debug&&!!e.logger.log},e.debug=!1,e.logger=console||null,e}();n.Log=h;var c=function(){function t(){this.observers=[]}return t.prototype.register=function(t){"object"==typeof t&&(this.observers.unshift(t),t.onRegister())},t.prototype.remove=function(e){this.observers=this.observers.filter(function(t){return t!==e})},t.prototype.notify=function(t){for(var e=this.observers.length;e--;){var n=this.observers[e];n.onNotify.call(n,t)}},t}();n.Observable=c;var u=function(){function t(){this.items=[],this.isRunning=!1}return t.prototype.add=function(t){this.items.unshift(t)},t.prototype.forEach=function(t){if(!this.isRunning){this.isRunning=!0;for(var e=this.items.length;e--;){var n=this.items.pop();n&&t(n)}this.isRunning=!1}},t.prototype.isEmpty=function(){return 0===this.items.length},t}();n.Queue=u;var p=function(){function t(t){this.baseUrl=t,this.baseUrl=t.replace(/^\w*:/,"").replace(/^\/\//,"").replace(/\/*$/,"")}return t.prototype.request=function(t){return this.options=t,this},t.prototype.then=function(t){switch(this.options.method){case"POST":this.post(t);break;case"GET":this.get(t)}},t.prototype.post=function(t){if(XMLHttpRequest){var e=new XMLHttpRequest,n=[this.baseUrl,this.options.path].join("/");e.open("POST","//"+n,!0),e.setRequestHeader("Content-Type","application/json"),e.onreadystatechange=function(){e.readyState===XMLHttpRequest.DONE&&t({xmlHttpRequest:e,statusCode:e.status,message:200<=e.status&&e.status<300||304===e.status?"ok":e.statusText})},e.onerror=function(){t({xmlHttpRequest:e,statusCode:e.status,message:"error"})},e.send(l.stringify(this.options.data))}else this.xhrNotFound(t)},t.prototype.get=function(t){if(XMLHttpRequest){var e=new XMLHttpRequest,n=[this.baseUrl,this.options.path].join("/")+l.encode(this.options.data);e.open("GET","//"+n,!0),e.send()}else this.xhrNotFound(t)},t.prototype.xhrNotFound=function(t){t({xmlHttpRequest:null,statusCode:-1,message:"XHR not supported"})},t}();n.RestClient=p;var l,f=function(){function t(t){this.milliseconds=t,this.isRunning=!1}return t.prototype.start=function(t){setInterval&&(this.isRunning||(this.intervalId=setInterval(t,this.milliseconds),this.isRunning=!0))},t.prototype.stop=function(){clearInterval&&(clearInterval(this.intervalId),this.isRunning=!1)},t}();n.Timer=f,function(t){function o(){return"object"==typeof window}function e(){return"object"==typeof top}function n(t,e){var n=t.split(".");return 2===n.length?o()&&typeof window[n[0]]===e&&typeof window[n[0]][n[1]]===e:o()&&typeof window[t]===e}function i(t){return o()&&window[t]}function r(){return e()&&-1<top.location.href.search(/^https/)}function a(t){return i("JSON")?window.JSON.stringify(t):t.toString()}t.isWindow=o,t.isTop=e,t.isVar=n,t.getVar=i,t.getScreenSize=function(){var t=window;return o()&&t.screen&&t.screen.width&&t.screen.height?t.screen.width+"x"+t.screen.height:"N/A"},t.isHttps=r,t.getProtocol=function(){return e()?r()?"https://":"http://":""},t.stringify=a,t.encode=function(t){return o()&&n("encodeURIComponent","function")?window.encodeURIComponent(a(t)):t.toString()}}(l=n.View||(n.View={}));var y=function(){function t(){this.vo=new g}return t.prototype.update=function(t){this.vo=this.mergeData(t),this.vo.timestamp=(new Date).getTime()},t.prototype.getData=function(){return this.vo},t.prototype.mergeData=function(t){var e=this.vo;for(var n in t)e.hasOwnProperty(n)&&null!==t[n]&&(e[n]=t[n]);return e},t}();n.DataVoProxy=y;var g=function(){this.playerName="",this.playerVersion="",this.playerInitTime=-1,this.playerManager={},this.dashJsPlayer={},this.hlsJsPlayer={},this.videoElement={},this.isMobile=!1,this.hasSessionResumed=!1,this.sessionId="",this.adBreakType="",this.adBreakPosition=-1,this.adBreakDuration=-1,this.adTitle="",this.adId="",this.adUrl="",this.adDuration=-1,this.adPosition=-1,this.mediaUrl="",this.category="",this.mediaId="",this.episodeTitle="",this.seriesTitle="",this.videoTitle="",this.airDate="",this.duration=-1,this.episodeFlag=!1,this.isLive=!1,this.timestamp=-1,this.playhead=0,this.season=NaN,this.episode=NaN,this.liveSegmentData={},this.cdn="",this.currentBitrate=-1,this.playbackFramerate=-1,this.drmEnabled=!1,this.drmType="",this.userId="",this.userStatus="anon",this.partner="",this.userCountry="",this.userConnectionType="",this.contextData={},this.ozTamMediaId="",this.ozTamOptOut=!1,this.nielsenOptOut=!1,this.errorType=-1,this.errorMessage="",this.errorFatal=!1};n.DataVo=g;var v,S,m=function(){function t(t,e){this.config=t,this.observable=e,this.notifications=new u,this.isAdPlaying=!1,this.isSdkLoaded=!1,this.debugId="[Tracker] "+t.name}return t.prototype.onRegister=function(){h.isDebug()&&h.logger.log(this.debugId,"start up")},t.prototype.onNotify=function(t){var e=this;this.notifications.add(t),this.hasSdkLoaded()&&this.notifications.forEach(function(t){e.onNotificationReceived(t)})},t.prototype.hasSdkLoaded=function(){if("object"!=typeof this.injectable)return this.isSdkLoaded;var t=this.injectable,e=l.getVar(t.name);return e&&(this[t.name]=e,this.isSdkLoaded=!0),this.isSdkLoaded},t.prototype.onNotificationReceived=function(t){switch(h.isDebug()&&h.logger.log(this.debugId,t.name,this.getDataVo().playhead),(this.notification=t).name){case v.AdBreakStart:case v.AdStart:this.isAdPlaying=!0;break;case v.AdEnd:case v.AdBreakEnd:case v.ContentStart:this.isAdPlaying=!1}},t.prototype.getDataVo=function(){return this.observable.dataProxy.getData()},t.prototype.hasContentCompleted=function(){var t=this.getDataVo();return(!t||!t.isLive)&&t.playhead>=.95*t.duration},t}();n.Agent=m,(S=v=n.AppEvent||(n.AppEvent={})).AdBreakEnd="adBreakEnd",S.AdBreakStart="adBreakStart",S.AdClick="adClick",S.AdEnd="adEnd",S.AdError="adError",S.AdLoaded="adLoaded",S.AdPause="adPause",S.AdResume="adResume",S.AdSkip="adSkip",S.AdStart="adStart",S.BitrateChange="bitrateChange",S.BufferEnd="bufferEnd",S.BufferStart="bufferStart",S.ContentEnd="contentEnd",S.ContentPause="contentPause",S.ContentResume="contentResume",S.ContentStart="contentStart",S.DashJsLoaded="dashJsLoaded",S.Heartbeat="hb",S.HlsJsLoaded="hlsJsLoaded",S.PlayerError="playerError",S.PlayerLoaded="playerLoaded",S.SeekEnd="seekEnd",S.SeekStart="seekStart",S.PlayheadUpdate="playheadUpdate",S.SessionEnd="sessionEnd",S.SessionStart="sessionStart";var k=function(){function t(){}return Object.defineProperty(t,"version",{get:function(){return"tracking v0.1.6 Thu, 27 Jun 2019 16:09:31 GMT"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"modules",{get:function(){return[A]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"applicationPlatform",{get:function(){return"Ps4"},enumerable:!0,configurable:!0}),t.isChromecast=function(){return"Chromecast"===t.applicationPlatform},t.isVizio=function(){return"Vizio"===t.applicationPlatform},t.isPs4=function(){return"Ps4"===t.applicationPlatform},t}();n.BuildInfo=k;var b=function(){function t(t){this.tracker=t,this.hasContentStart=!1,this.isStopped=!0,this.timer=new f(1e4)}return t.prototype.onRegister=function(){},t.prototype.onNotify=function(t){switch(t.name){case v.ContentStart:this.hasContentStart=!0;break;case v.ContentPause:case v.BufferStart:case v.SeekStart:case v.AdBreakStart:case v.AdStart:this.isStopped=!0,this.timer.stop();break;case v.PlayheadUpdate:this.isStopped&&this.hasContentStart&&(this.isStopped=!1,this.startHb());break;case v.ContentEnd:case v.SessionEnd:this.hasContentStart=!1,this.isStopped=!0,this.timer.stop()}},t.prototype.startHb=function(){var t=this;this.timer.start(function(){t.tracker.track(v.Heartbeat)})},t}();n.Heartbeat=b;var C=function(){function t(){}return t.prototype.registerAgents=function(o){var i=this;this.tracker=o,this.tracker.register(new b(o)),this.tracker.modules.forEach(function(t){var e=t;if(i.isAgentEnabled(e.NAME)){var n=i.getAgentConfig(e.NAME);i.registerAgent(new e(n,o))}})},t.prototype.isAgentEnabled=function(t){return this.tracker.config.hasOwnProperty(t)&&this.tracker.config[t].hasOwnProperty("enabled")&&this.tracker.config[t].enabled},t.prototype.getAgentConfig=function(t){var e=this.tracker.config[t];return e.name=t,e},t.prototype.registerAgent=function(t){this.tracker.register(t)},t}();n.Registrar=C;var E=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.dataProxy=new y,t.registrar=new C,t.modules=k.modules,t}return i(t,n),t.prototype.track=function(t,e){e=e||{},this.dataProxy.update(e),n.prototype.notify.call(this,{name:t})},t.prototype.setConfig=function(t){this.config||(this.config=t,this.registrar.registerAgents(this))},t.prototype.setContextData=function(t){this.dataProxy.update({contextData:t})},t.prototype.setLiveSegmentData=function(t){this.dataProxy.update({liveSegmentData:t})},t.prototype.setDebug=function(t){h.debug=t,h.isDebug()&&h.logger.log(k.version)},t.prototype.setLogger=function(t){h.setLogger(t)},t}(c),P=function(o){function t(){var t,e=null!==o&&o.apply(this,arguments)||this;return e.hasResourceReady=!1,e.hasContentStart=!1,e.hasContentPause=!1,e.hasBufferStart=!1,e.hasSeekStart=!1,e.doContentStart=!1,e.localPlayhead=0,e.eventMap=((t={resourceReady:e.onResourceReady,contentPlaying:e.onPlaying,contentPaused:e.onPause,contentSeeking:e.onSeeking,contentBuffering:e.onBuffering,contentBitrateChanged:e.onBitrateChanged,contentTimeupdate:e.onTimeUpdate,resourceError:e.onResourceError})[v.Heartbeat]=function(){return o.prototype.track.call(e,v.Heartbeat)},t),e}return i(t,o),t.prototype.setModel=function(t){(this.model=t).resource&&t.resource.contextMetadata&&o.prototype.setContextData.call(this,this.model.resource.contextMetadata)},t.prototype.registerUvpc=function(t){this.setConfig(t)},t.prototype.track=function(t,e){var n=this.eventMap[t];n&&n.call(this,e)},t.prototype.onResourceReady=function(){this.hasResourceReady||(this.hasResourceReady=!0,this.trackEvent(v.SessionStart,{playerName:this.model.collection.BuildInfo.playerName,playerVersion:this.model.collection.BuildInfo.playerVersion,sessionId:"<the-session-id>",hasSessionResumed:!1,userId:"<the-user-id>",partner:"<partner>",userCountry:"<the-two-digit-country-code>",drmEnabled:!1,userConnectionType:"desktop",videoElement:this.model.collection.PlayerDom.video,isMobile:!1}))},t.prototype.onPlaying=function(){this.hasContentStart?this.hasContentPause?(this.hasContentPause=!1,this.trackEvent(v.ContentResume)):this.hasSeekStart&&(this.hasSeekStart=!1,this.trackEvent(v.SeekEnd)):(this.hasContentStart=!0,this.doContentStart=!0)},t.prototype.onPause=function(){this.hasContentStart&&!this.hasContentPause&&(this.hasContentPause=!0,this.trackEvent(v.ContentPause))},t.prototype.onSeeking=function(){this.hasContentStart&&!this.hasSeekStart&&(this.hasSeekStart=!0,this.trackEvent(v.SeekStart))},t.prototype.onBuffering=function(){this.hasContentStart&&!this.hasBufferStart&&(this.hasBufferStart=!0,this.trackEvent(v.BufferStart))},t.prototype.onBitrateChanged=function(){this.hasContentStart&&this.trackEvent(v.BitrateChange,{currentBitrate:this.model.collection.ContentPlaybackState.playbackBitrate})},t.prototype.onTimeUpdate=function(){if(this.hasContentStart&&this.doContentStart&&(this.trackContentStart(),this.doContentStart=!1),this.hasBufferStart&&(this.hasBufferStart=!1,this.trackEvent(v.BufferEnd)),!this.hasContentPause){var t=Math.floor(this.model.collection.ContentPlaybackState.playheadTime);t>this.localPlayhead&&(this.localPlayhead=t,this.hasContentStart&&this.trackEvent(v.PlayheadUpdate))}},t.prototype.onContentEnd=function(){this.hasContentStart&&this.trackEvent(v.ContentEnd),this.hasContentStart=!1},t.prototype.onResourceError=function(t){this.trackEvent(v.PlayerError,{errorType:t.status||NaN,errorMessage:t.message||"",errorFatal:t.isFatal||!1})},t.prototype.trackContentStart=function(){var t=this.model.resource;this.trackEvent(v.ContentStart,{mediaUrl:t.resourceLocation.mediaUrl,mediaId:"resource.contentMetadata.videoTitle",duration:this.model.collection.ContentPlaybackState.duration,videoTitle:"resource.contentMetadata.videoTitle",seriesTitle:t.contentMetadata.seriesTitle,season:t.contentMetadata.seasonNumber,episode:t.contentMetadata.episodeNumber,category:t.contentMetadata.category,isLive:this.isLive(),episodeFlag:t.contentMetadata.episodeFlag,ozTamMediaId:"",ozTamOptOut:!1})},t.prototype.trackEvent=function(t,e){var n=e||{};this.isModelDefined()&&this.model.collection.ContentPlaybackState&&(n.playhead=this.localPlayhead),o.prototype.track.call(this,t,n)},t.prototype.trackSessionEnd=function(){this.hasResourceReady=!1,this.hasContentStart=!1,this.hasContentPause=!1,this.hasBufferStart=!1,this.hasSeekStart=!1,this.doContentStart=!1,this.trackEvent(v.SessionEnd)},t.prototype.isLive=function(){var t=this.model.resource.contentMetadata.streamType;return!(!t||"LIVE"!==t.toLocaleUpperCase())},t.prototype.isModelDefined=function(){return this.model&&"object"==typeof this.model.collection},t}(n.Tracker=E);n.CvTracker=P;var A=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hasAdobeSession=!1,t.isStopped=!1,t.isSdkLoaded=!0,t}return i(t,e),t.prototype.onRegister=function(){e.prototype.onRegister.call(this),this.vo=new R(this),this.restClient=new p(h.isDebug()?this.vo.devApiServer:this.vo.prodApiServer),this.eventQueue=new u},t.prototype.onNotificationReceived=function(t){switch(e.prototype.onNotificationReceived.call(this,t),t.name){case v.AdBreakStart:this.trackEvent("adBreakStart");break;case v.AdStart:this.trackEvent("adStart");break;case v.AdClick:case v.AdPause:this.trackEvent("pauseStart");break;case v.AdEnd:this.trackEvent("adComplete");break;case v.AdBreakEnd:this.trackEvent("adBreakComplete");break;case v.ContentStart:this.hasAdobeSession||this.requestAdobeSession(),this.trackEvent("play");break;case v.ContentPause:this.isStopped=!0,this.trackEvent("pauseStart");break;case v.BufferStart:this.isStopped=!0,this.trackEvent("bufferStart");break;case v.SeekStart:this.isStopped=!0;break;case v.ContentResume:case v.PlayheadUpdate:this.isStopped&&(this.isStopped=!1,this.trackEvent("play"));break;case v.Heartbeat:this.trackEvent("ping");break;case v.SessionEnd:this.trackSessionEnd()}},t.prototype.trackEvent=function(t){this.eventQueue.add(t),this.processEventQueue()},t.prototype.processEventQueue=function(){var e=this;this.hasAdobeSession&&this.eventQueue.forEach(function(t){e.sendTrackRequest(t)})},t.prototype.sendTrackRequest=function(t){if("play"!==t||!this.isAdPlaying){var e={path:this.apiPath,data:this.vo.getPayload(t),method:"POST"};h.isDebug()&&h.logger.log(this.debugId,t,e),this.restClient.request(e).then(function(t){})}},t.prototype.requestAdobeSession=function(){var n=this,t={path:R.SESSION_PATH,data:this.vo.getSessionStartData(),method:"POST"};h.isDebug()&&h.logger.log(this.debugId,t),this.restClient.request(t).then(function(t){if(404===t.statusCode)throw"Error: Server response 404";var e=t.xmlHttpRequest.getResponseHeader("location");if(!e)throw"Error: Location not found";n.hasAdobeSession=!0,n.apiPath=n.vo.getApiPath(e),h.isDebug()&&h.logger.log(n.debugId,n.apiPath),n.processEventQueue()})},t.prototype.trackSessionEnd=function(){this.hasContentCompleted()&&this.trackEvent("sessionComplete"),this.trackEvent("sessionEnd"),this.hasAdobeSession=!1},t.NAME="Adobe",t=r([d()],t)}(m);n.AdobeAgent=A;var R=function(n){function t(t){var e=n.call(this,t.config.params)||this;return e.agent=t,e}return i(t,n),t.prototype.getSessionStartData=function(){var t=this.agent.getDataVo(),e=this.getPayload("sessionStart");return e.params={"analytics.trackingServer":this.trackingServer,"analytics.reportSuite":this.reportSuite,"analytics.visitorId":this.visitorId,"analytics.enableSSL":this.enableSSL,"visitor.marketingCloudOrgId":this.marketingCloudOrgId,"visitor.marketingCloudUserId":this.getMarketingCloudUserId(),"media.playerName":t.playerName,"media.contentType":t.isLive?"Live":"VOD","media.length":t.duration,"media.id":t.mediaId,"media.name":t.videoTitle,"media.channel":this.channel,"media.sdkVersion":t.playerVersion.toString(),"media.network":this.channel,"media.showType":t.episodeFlag?"0":"2","media.resume":!!t.hasSessionResumed},t.seriesTitle&&(e.params["media.show"]=t.seriesTitle),t.category&&(e.params["media.genre"]=t.category),t.season&&(e.params["media.season"]=t.season.toString()),t.episode&&(e.params["media.episode"]=t.episode.toString()),t.contextData.mediaResume=t.hasSessionResumed?"true":"false",e.customMetadata=this.dataToString(t.contextData),e},t.prototype.getMarketingCloudUserId=function(){if(this.marketingCloudUserId)return this.marketingCloudUserId;var t=l.getVar("Visitor");if(!t)return"";var e=t.getInstance(this.marketingCloudOrgId,this.visitorOptions||{});return e&&e.getMarketingCloudVisitorID?e.getMarketingCloudVisitorID():""},t.prototype.getAdBreakStartData=function(){var t=this.agent.getDataVo();return{"media.ad.podFriendlyName":t.adBreakType,"media.ad.podIndex":t.adBreakPosition,"media.ad.podSecond":t.playhead}},t.prototype.getAdItemData=function(){var t=this.agent.getDataVo();return{"media.ad.name":t.adTitle,"media.ad.id":t.videoTitle+" - "+t.adTitle,"media.ad.length":t.adDuration,"media.ad.creativeId":t.adId,"media.ad.creativeURL":t.adUrl,"media.ad.playerName":t.playerName,"media.ad.podPosition":t.adPosition}},t.prototype.getApiPath=function(t){return[t=t.replace(/^\/|\/$/g,""),"events"].join("/")},t.prototype.getPayload=function(t){var e=this.agent.getDataVo(),n={};switch(t){case"adBreakStart":n=this.getAdBreakStartData();break;case"adStart":n=this.getAdItemData()}return{eventType:t,playerTime:{playhead:e.playhead,ts:(new Date).getTime()},params:n}},t.SESSION_PATH="api/v1/sessions",r([a(!1)],t.prototype,"enableSSL",void 0),r([a()],t.prototype,"channel",void 0),r([a()],t.prototype,"reportSuite",void 0),r([a()],t.prototype,"trackingServer",void 0),r([a()],t.prototype,"marketingCloudOrgId",void 0),r([a()],t.prototype,"marketingCloudUserId",void 0),r([a()],t.prototype,"visitorId",void 0),r([a()],t.prototype,"devApiServer",void 0),r([a()],t.prototype,"prodApiServer",void 0),r([a(1e4)],t.prototype,"hbInterval",void 0),r([a()],t.prototype,"visitorOptions",void 0),t=r([d()],t)}(s);n.AdobeVo=R},{}]},{},[1])(1)});