!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;((e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).vtg||(e.vtg={})).tracking=t()}}(function(){return function a(s,r,d){function h(e,t){if(!r[e]){if(!s[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(p)return p(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var o=r[e]={exports:{}};s[e][0].call(o.exports,function(t){return h(s[e][1][t]||t)},o,o.exports,a,s,r,d)}return r[e].exports}for(var p="function"==typeof require&&require,t=0;t<d.length;t++)h(d[t]);return h}({1:[function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),a=this&&this.__decorate||function(t,e,i,n){var o,a=arguments.length,s=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var r=t.length-1;0<=r;r--)(o=t[r])&&(s=(a<3?o(s):3<a?o(e,i,s):o(e,i))||s);return 3<a&&s&&Object.defineProperty(e,i,s),s};function s(i){return function(t,e){t.keys||(t.keys={}),t.keys[e]=function(t){return t.hasOwnProperty(e)&&t[e]?t[e]:"boolean"!=typeof i?i||"":i}}}function r(i){return function(t,e){t.rule||(t.rule={}),t.rule[e]=i.bind(t)}}Object.defineProperty(i,"__esModule",{value:!0}),i.ModuleParam=s,i.Rule=r;var d=function(){function t(t){this.data=t,this.format()}return t.prototype.format=function(){var e=this,i=this;return Object.keys(this.keys).forEach(function(t){i[t]=e.keys[t](e.data)}),i},t.prototype.dataToString=function(t){var e={};for(var i in t)t.hasOwnProperty(i)&&void 0!==t[i]&&null!==t[i]&&(e[i]=t[i].toString());return e},t}();function h(){return function(t){t.prototype.destroy=function(){var e=this;"function"==typeof this.onBeforeDestroy&&this.onBeforeDestroy(),Object.keys(this).forEach(function(t){"function"!=typeof e[t]&&(e[t]=null)})}}}function p(e){return function(t){t.prototype.injectable=e}}i.DataAccess=d,i.Destroyable=h,i.Injectable=p;var u=function(){function e(){}return e.setLogger=function(t){"object"==typeof t&&"function"==typeof t.log&&(e.logger=t)},e.isDebug=function(){return e.debug&&!!e.logger.log},e.debug=!1,e.logger=console||null,e}();i.Log=u;var c=function(){function t(){this.observers=[]}return t.prototype.register=function(t){"object"==typeof t&&(this.observers.unshift(t),t.onRegister())},t.prototype.remove=function(e){this.observers=this.observers.filter(function(t){return t!==e})},t.prototype.notify=function(t){for(var e=this.observers.length;e--;){var i=this.observers[e];i.onNotify.call(i,t)}},t}();i.Observable=c;var l=function(){function t(){this.items=[],this.isRunning=!1}return t.prototype.add=function(t){this.items.unshift(t)},t.prototype.forEach=function(t){if(!this.isRunning){this.isRunning=!0;for(var e=this.items.length;e--;){var i=this.items.pop();i&&t(i)}this.isRunning=!1}},t.prototype.isEmpty=function(){return 0===this.items.length},t}();i.Queue=l;var f=function(){function t(t){this.baseUrl=t,this.baseUrl=t.replace(/^\w*:/,"").replace(/^\/\//,"").replace(/\/*$/,"")}return t.prototype.request=function(t){return this.options=t,this},t.prototype.then=function(t){switch(this.options.method){case"POST":this.post(t);break;case"GET":this.get(t)}},t.prototype.post=function(t){if(XMLHttpRequest){var e=new XMLHttpRequest,i=[this.baseUrl,this.options.path].join("/");e.open("POST","//"+i,!0),e.setRequestHeader("Content-Type","application/json"),e.onreadystatechange=function(){e.readyState===XMLHttpRequest.DONE&&t({xmlHttpRequest:e,statusCode:e.status,message:200<=e.status&&e.status<300||304===e.status?"ok":e.statusText})},e.onerror=function(){t({xmlHttpRequest:e,statusCode:e.status,message:"error"})},e.send(g.stringify(this.options.data))}else this.xhrNotFound(t)},t.prototype.get=function(t){if(XMLHttpRequest){var e=new XMLHttpRequest,i=[this.baseUrl,this.options.path].join("/")+this.options.data;e.open("GET","//"+i,!0),e.send()}else this.xhrNotFound(t)},t.prototype.xhrNotFound=function(t){t({xmlHttpRequest:null,statusCode:-1,message:"XHR not supported"})},t}();i.RestClient=f;var g,v=function(){function t(t){this.milliseconds=t,this.isRunning=!1}return t.prototype.start=function(t){setInterval&&(this.isRunning||(this.intervalId=setInterval(t,this.milliseconds),this.isRunning=!0))},t.prototype.stop=function(){clearInterval&&(clearInterval(this.intervalId),this.isRunning=!1)},t}();i.Timer=v,function(t){function n(){return"object"==typeof window}function e(){return"object"==typeof top}function i(t){return n()&&window[t]}function o(){return e()&&-1<top.location.href.search(/^https/)}t.isWindow=n,t.isTop=e,t.isVar=function(t,e){var i=t.split(".");return 2===i.length?n()&&typeof window[i[0]]===e&&typeof window[i[0]][i[1]]===e:n()&&typeof window[t]===e},t.getVar=i,t.getScreenSize=function(){var t=window;return n()&&t.screen&&t.screen.width&&t.screen.height?t.screen.width+"x"+t.screen.height:"N/A"},t.isHttps=o,t.getProtocol=function(){return e()?o()?"https://":"http://":""},t.stringify=function(t){return i("JSON")?window.JSON.stringify(t):t.toString()}}(g=i.View||(i.View={}));var y=function(){function t(){this.vo=new S}return t.prototype.update=function(t){this.vo=this.mergeData(t),this.vo.timestamp=(new Date).getTime()},t.prototype.getData=function(){return this.vo},t.prototype.mergeData=function(t){var e=this.vo;for(var i in t)e.hasOwnProperty(i)&&void 0!==t[i]&&null!==t[i]&&(e[i]=this.vo.applyRule(i,t));return e},t}();i.DataVoProxy=y;var m=function(){function t(){}return t.toInt=function(t){return Math.floor(t)},t.toKbps=function(t){return Math.floor(t/1e3)},t.toLowercase=function(t){return t?t.toLocaleLowerCase():""},t}();i.DataRule=m;var S=function(){function t(){this.playerId="",this.playerName="",this.playerVersion="",this.playerInitTime=-1,this.playerManager={},this.dashJsPlayer={},this.hlsJsPlayer={},this.videoElement={},this.isMobile=!1,this.hasSessionResumed=!1,this.sessionId="",this.adBreakType="",this.adBreakPosition=-1,this.adBreakDuration=-1,this.adTitle="",this.adId="",this.adUrl="",this.adDuration=-1,this.adPosition=-1,this.mediaUrl="",this.category="",this.mediaId="",this.episodeTitle="",this.seriesTitle="",this.videoTitle="",this.airDate="",this.isPaidContent=!1,this.isAffiliateFeed=!1,this.duration=-1,this.episodeFlag=!1,this.isLive=!1,this.isDai=!1,this.timestamp=-1,this.playhead=0,this.season=NaN,this.episode=NaN,this.liveSegmentData={},this.cdn="",this.currentBitrate=-1,this.playbackFramerate=-1,this.drmEnabled=!1,this.drmType="",this.userId="",this.userStatus="anon",this.partner="",this.userCountry="",this.userConnectionType="",this.siteId="",this.contextData={},this.ozTamMediaId="",this.ozTamOptOut=!1,this.nielsenOptOut=!1,this.errorType=-1,this.errorMessage="",this.errorFatal=!1}return t.prototype.applyRule=function(t,e){return this.rule[t]?this.rule[t].call(this,e[t]):e[t]},a([r(m.toInt)],t.prototype,"adBreakDuration",void 0),a([r(m.toInt)],t.prototype,"adDuration",void 0),a([r(m.toInt)],t.prototype,"duration",void 0),a([r(m.toInt)],t.prototype,"playhead",void 0),a([r(m.toKbps)],t.prototype,"currentBitrate",void 0),a([r(m.toLowercase)],t.prototype,"userCountry",void 0),t}();i.DataVo=S;var k,E,b=function(){function t(t,e){this.config=t,this.observable=e,this.notifications=new l,this.isAdPlaying=!1,this.isSdkLoaded=!1,this.debugId="[Tracker] "+t.name}return t.prototype.onRegister=function(){u.isDebug()&&u.logger.log(this.debugId,"start up")},t.prototype.onNotify=function(t){var e=this;this.notifications.add(t),this.hasSdkLoaded()&&this.notifications.forEach(function(t){e.onNotificationReceived(t)})},t.prototype.hasSdkLoaded=function(){if("object"!=typeof this.injectable)return this.isSdkLoaded;var t=this.injectable,e=g.getVar(t.name);return e&&(this[t.name]=e,this.isSdkLoaded=!0),this.isSdkLoaded},t.prototype.onNotificationReceived=function(t){switch(u.isDebug()&&u.logger.log(this.debugId,t.name,this.getDataVo().playhead),(this.notification=t).name){case k.AdBreakStart:case k.AdStart:this.isAdPlaying=!0;break;case k.AdEnd:case k.AdBreakEnd:case k.ContentStart:this.isAdPlaying=!1}},t.prototype.getDataVo=function(){return this.observable.dataProxy.getData()},t.prototype.hasContentCompleted=function(){var t=this.getDataVo();return(!t||!t.isLive)&&t.playhead>=.95*t.duration},t}();i.Agent=b,(E=k=i.AppEvent||(i.AppEvent={})).AdBreakEnd="adBreakEnd",E.AdBreakStart="adBreakStart",E.AdClick="adClick",E.AdEnd="adEnd",E.AdError="adError",E.AdLoaded="adLoaded",E.AdPause="adPause",E.AdResume="adResume",E.AdSkip="adSkip",E.AdStart="adStart",E.Ad1stQt="ad1stQt",E.Ad2ndQt="ad2ndQt",E.Ad3rdQt="ad3rdQt",E.BitrateChange="bitrateChange",E.BufferEnd="bufferEnd",E.BufferStart="bufferStart",E.ContentEnd="contentEnd",E.ContentPause="contentPause",E.ContentResume="contentResume",E.ContentStart="contentStart",E.DashJsLoaded="dashJsLoaded",E.Heartbeat="hb",E.HlsJsLoaded="hlsJsLoaded",E.LiveSegmentStart="liveSegmentStart",E.LiveSegmentEnd="liveSegmentEnd",E.PlayerError="playerError",E.PlayerLoaded="playerLoaded",E.SeekEnd="seekEnd",E.SeekStart="seekStart",E.PlayheadUpdate="playheadUpdate",E.SessionEnd="sessionEnd",E.SessionStart="sessionStart";var C=function(){function t(){}return Object.defineProperty(t,"version",{get:function(){return"tracking v0.1.8 Tue, 20 Aug 2019 19:11:03 GMT"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"modules",{get:function(){return[D,B,w]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"applicationPlatform",{get:function(){return"Chromecast"},enumerable:!0,configurable:!0}),t.isChromecast=function(){return"Chromecast"===t.applicationPlatform},t.isVizio=function(){return"Vizio"===t.applicationPlatform},t.isPs4=function(){return"Ps4"===t.applicationPlatform},t.isDev=function(){return!(!window.utag||!window.utag.data||"dev"!==window.utag.data["ut.env"])},t}();i.BuildInfo=C;var P=function(){function t(t){this.tracker=t,this.hasContentStart=!1,this.hasSessionEnd=!1,this.isStopped=!0,this.isAd=!1,this.config={name:"Hb",enabled:!0,params:{}},this.timer=new v(1e4)}return t.prototype.onRegister=function(){},t.prototype.onNotify=function(t){switch(t.name){case k.ContentStart:this.hasSessionEnd=!1,this.hasContentStart=!0;break;case k.AdBreakStart:this.isAd=!0,this.timer.stop();break;case k.AdBreakEnd:this.isAd=!1;break;case k.ContentPause:case k.BufferStart:case k.SeekStart:this.isStopped=!0,this.startHb();break;case k.PlayheadUpdate:this.onPlayheadUpdate();break;case k.ContentEnd:case k.SessionEnd:this.hasSessionEnd=!0,this.hasContentStart=!1,this.isStopped=!0,this.timer.stop()}},t.prototype.onPlayheadUpdate=function(){this.hasSessionEnd||this.isStopped&&this.hasContentStart&&!this.isAd&&(this.isStopped=!1,this.startHb())},t.prototype.startHb=function(){var t=this;this.timer.stop(),this.timer.start(function(){t.tracker.track(k.Heartbeat)})},t.NAME="Hb",t}();i.Heartbeat=P;var I=function(){function t(){}return t.prototype.register=function(n){var o=this;this.tracker=n,this.registerAgent(new P(n)),this.tracker.modules.forEach(function(t){var e=t;if(o.isAgentEnabled(e.NAME)){var i=o.getAgentConfig(e.NAME);o.registerAgent(new e(i,n))}})},t.prototype.update=function(i){var n=this,t=this.tracker.observers.filter(function(t){var e=t;return e.config&&e.config.name&&i[t.config.name]});for(var e in t.forEach(function(t){var e=t.config.name;i[e].enabled||n.tracker.remove(t)}),i){var o=i[e];this.tracker.config[e]=o}this.register(this.tracker)},t.prototype.isAgentEnabled=function(t){return this.tracker.config.hasOwnProperty(t)&&this.tracker.config[t].hasOwnProperty("enabled")&&this.tracker.config[t].enabled},t.prototype.getAgentConfig=function(t){var e=this.tracker.config[t];return e.params||(e.params={}),e.name||(e.name=t),e},t.prototype.registerAgent=function(e){!!this.tracker.observers.find(function(t){return t.config.name===e.config.name})||this.tracker.register(e)},t}();i.Registrar=I;var A=function(i){function t(){var t=null!==i&&i.apply(this,arguments)||this;return t.dataProxy=new y,t.registrar=new I,t.modules=C.modules,t}return o(t,i),t.prototype.track=function(t,e){this.dataProxy.update(e||{}),i.prototype.notify.call(this,{name:t})},t.prototype.setConfig=function(t){this.setDebug(C.isDev()),this.config?this.registrar.update(t):(this.config=t,this.registrar.register(this))},t.prototype.setContextData=function(t){this.dataProxy.update({contextData:t})},t.prototype.setLiveSegmentData=function(t){this.dataProxy.update({liveSegmentData:t})},t.prototype.setDebug=function(t){u.debug=t,u.isDebug()&&u.logger.log(C.version)},t.prototype.setLogger=function(t){u.setLogger(t)},t}(c),T=function(a){function t(){var t=a.call(this)||this;return t.playhead=0,t.hasPlayerLoadComplete=!1,t.hasSessionStart=!1,t.hasClipStarted=!1,t.hasBreakStarted=!1,t.isBuffering=!1,t.isAdPlaying=!1,t.isPaused=!1,t.isSeeking=!1,t.eventCallback={},t.context=cast.framework.CastReceiverContext.getInstance(),t.playerManager=t.context.getPlayerManager(),t.addEventListeners(),t}return o(t,a),t.prototype.addEventListeners=function(){var t,e=this,i=cast.framework.events.EventType,n=((t={})[i.PLAYER_LOAD_COMPLETE]=this.onPlayerLoadComplete,t[i.CLIP_STARTED]=this.onClipStarted,t[i.BREAK_STARTED]=this.onBreakStarted,t[i.BREAK_CLIP_STARTED]=this.onBreakClipStarted,t[i.BREAK_CLIP_ENDED]=this.onBreakClipEnded,t[i.BREAK_ENDED]=this.onBreakEnded,t[i.BUFFERING]=this.onBuffering,t[i.TIME_UPDATE]=this.onTimeUpdate,t[i.PLAYING]=this.onPlaying,t[i.PAUSE]=this.onPause,t[i.REQUEST_SEEK]=this.onRequestSeek,t[i.SEEKED]=this.onSeeked,t[i.BITRATE_CHANGED]=this.onBitRateChanged,t[i.MEDIA_FINISHED]=this.onMediaFinished,t[i.ERROR]=this.onPlayerError,t);Object.keys(n).forEach(function(t){e.playerManager.addEventListener(t,n[t].bind(e))})},t.prototype.on=function(t,e){this.eventCallback[t]=e},t.prototype.onPlayerLoadComplete=function(t){this.hasPlayerLoadComplete=!0,a.prototype.track.call(this,k.PlayerLoaded)},t.prototype.onClipStarted=function(t){this.isAdPlaying&&this.hasClipStarted||(this.hasPlayerLoadComplete&&!this.hasClipStarted&&(this.startSession(t),this.trackEvent(k.ContentStart,t)),this.hasClipStarted=!0)},t.prototype.onBreakStarted=function(t){this.hasPlayerLoadComplete&&(this.startSession(t),this.hasBreakStarted=!0,this.trackEvent(k.AdBreakStart,t))},t.prototype.onBreakClipStarted=function(t){this.hasPlayerLoadComplete&&(!this.hasBreakStarted&&this.onBreakStarted(t),this.isAdPlaying=!0,this.trackEvent(k.AdStart,t))},t.prototype.onBreakClipEnded=function(t){this.isAdPlaying=!1,this.isPaused=!1,"SKIPPED"===t.endedReason&&this.trackEvent(k.AdSkip,t),this.trackEvent(k.AdEnd,t)},t.prototype.onBreakEnded=function(t){this.isAdPlaying=!1,this.hasBreakStarted=!1,this.trackEvent(k.AdBreakEnd,t)},t.prototype.onBuffering=function(t){this.hasSessionStart&&!this.isBuffering&&(this.isBuffering=!0,this.trackEvent(k.BufferStart,t))},t.prototype.onTimeUpdate=function(t){if(this.isBuffering&&(this.isBuffering=!1,this.trackEvent(k.BufferEnd,t)),!this.isPaused&&t.currentMediaTime){var e=Math.floor(t.currentMediaTime);this.playhead!==e&&(this.playhead=e,this.trackEvent(k.PlayheadUpdate,t))}},t.prototype.onPlaying=function(t){this.isPaused&&(this.isPaused=!1,this.trackEvent(this.isAdPlaying?k.AdResume:k.ContentResume,t))},t.prototype.onPause=function(t){this.isPaused||(this.isPaused=!0,this.trackEvent(this.isAdPlaying?k.AdPause:k.ContentPause,t))},t.prototype.onRequestSeek=function(t){this.isSeeking=!0,this.trackEvent(k.SeekStart,t)},t.prototype.onSeeked=function(t){this.isSeeking&&(this.trackEvent(k.SeekEnd,t),this.isSeeking=!1)},t.prototype.onBitRateChanged=function(t){this.trackEvent(k.BitrateChange,t,{currentBitrate:t.totalBitrate})},t.prototype.onMediaFinished=function(t){this.trackSessionEnd(t)},t.prototype.onPlayerError=function(t){t&&t.endedReason&&t.endedReason===cast.framework.events.EndedReason.ERROR&&this.trackEvent(k.PlayerError,t,{errorCode:t.detailedErrorCode,errorMessage:t.endedReason,isFatal:!1})},t.prototype.startSession=function(t){this.hasPlayerLoadComplete&&!this.hasSessionStart&&(this.hasSessionStart=!0,this.trackSessionStart(t))},t.prototype.trackSessionStart=function(t){this.trackEvent(k.SessionStart,t,{playerManager:this.playerManager,playerInitTime:(new Date).getTime()})},t.prototype.trackSessionEnd=function(t){this.trackEvent(k.ContentEnd,t),this.hasPlayerLoadComplete=!1,this.hasSessionStart=!1,this.hasClipStarted=!1,this.hasBreakStarted=!1,this.isAdPlaying=!1,this.isBuffering=!1,this.isPaused=!1,this.trackEvent(k.SessionEnd,t)},t.prototype.trackEvent=function(t,e,i){var n=i||{};if("function"==typeof this.eventCallback[t]){var o=this.eventCallback[t](e);"object"==typeof o&&(Object.keys(o).forEach(function(t){n[t]=o[t]}),delete this.eventCallback[t])}n.hasOwnProperty("playhead")?this.playhead=n.playhead:n.playhead=this.playhead,a.prototype.track.call(this,t,n)},t}(i.Tracker=A);i.ChromecastTracker=T;var D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hasAdobeSession=!1,t.isStopped=!1,t.isSdkLoaded=!0,t}return o(t,e),t.prototype.onRegister=function(){e.prototype.onRegister.call(this),this.vo=new R(this),this.restClient=new f(u.isDebug()?this.vo.devApiServer:this.vo.prodApiServer),this.eventQueue=new l},t.prototype.onNotificationReceived=function(t){switch(e.prototype.onNotificationReceived.call(this,t),t.name){case k.AdBreakStart:this.trackEvent("adBreakStart");break;case k.AdStart:this.trackEvent("adStart");break;case k.AdClick:case k.AdPause:this.trackEvent("pauseStart");break;case k.AdEnd:this.trackEvent("adComplete");break;case k.AdBreakEnd:this.trackEvent("adBreakComplete");break;case k.ContentStart:this.hasAdobeSession||this.requestAdobeSession(),this.trackEvent("play");break;case k.ContentPause:this.isStopped=!0,this.trackEvent("pauseStart");break;case k.BufferStart:this.isStopped=!0,this.trackEvent("bufferStart");break;case k.SeekStart:this.isStopped=!0;break;case k.ContentResume:case k.PlayheadUpdate:this.isStopped&&(this.isStopped=!1,this.trackEvent("play"));break;case k.Heartbeat:case k.Ad1stQt:case k.Ad2ndQt:case k.Ad3rdQt:this.trackEvent("ping");break;case k.SessionEnd:this.trackSessionEnd()}},t.prototype.trackEvent=function(t){this.eventQueue.add(t),this.processEventQueue()},t.prototype.processEventQueue=function(){var e=this;this.hasAdobeSession&&this.eventQueue.forEach(function(t){e.sendTrackRequest(t)})},t.prototype.sendTrackRequest=function(t){if("play"!==t||!this.isAdPlaying){var e={path:this.apiPath,data:this.vo.getPayload(t),method:"POST"};u.isDebug()&&u.logger.log(this.debugId,t,e),this.restClient.request(e).then(function(t){})}},t.prototype.requestAdobeSession=function(){var i=this,t={path:R.SESSION_PATH,data:this.vo.getSessionStartData(),method:"POST"};u.isDebug()&&u.logger.log(this.debugId,t),this.restClient.request(t).then(function(t){if(404===t.statusCode)throw"Error: Server response 404";var e=t.xmlHttpRequest.getResponseHeader("location");if(!e)throw"Error: Location not found";i.hasAdobeSession=!0,i.apiPath=i.vo.getApiPath(e),u.isDebug()&&u.logger.log(i.debugId,i.apiPath),i.processEventQueue()})},t.prototype.trackSessionEnd=function(){this.hasContentCompleted()&&this.trackEvent("sessionComplete"),this.trackEvent("sessionEnd"),this.hasAdobeSession=!1},t.NAME="Adobe",t=a([h()],t)}(b);i.AdobeAgent=D;var R=function(i){function t(t){var e=i.call(this,t.config.params)||this;return e.agent=t,e}var n;return o(t,i),(n=t).prototype.getSessionStartData=function(){var t=this.agent.getDataVo(),e=this.getPayload("sessionStart");return e.params={"analytics.trackingServer":this.trackingServer,"analytics.reportSuite":this.reportSuite,"analytics.visitorId":this.visitorId,"analytics.enableSSL":this.enableSSL,"visitor.marketingCloudOrgId":this.marketingCloudOrgId,"visitor.marketingCloudUserId":this.getMarketingCloudUserId(),"media.playerName":t.playerName,"media.contentType":t.isLive?"Live":"VOD","media.length":t.isLive?n.LIVE_CONTENT_LENGTH:t.duration,"media.id":t.mediaId,"media.name":t.videoTitle,"media.channel":this.channel,"media.sdkVersion":t.playerVersion&&t.playerVersion.toString(),"media.network":this.channel,"media.showType":t.episodeFlag?"0":"2","media.resume":!!t.hasSessionResumed},t.seriesTitle&&(e.params["media.show"]=t.seriesTitle),t.category&&(e.params["media.genre"]=t.category),t.season&&(e.params["media.season"]=t.season.toString()),t.episode&&(e.params["media.episode"]=t.episode.toString()),t.contextData.mediaResume=t.hasSessionResumed?"true":"false",e.customMetadata=this.dataToString(t.contextData),e},t.prototype.getMarketingCloudUserId=function(){if(this.marketingCloudUserId)return this.marketingCloudUserId;var t=g.getVar("Visitor");if(!t)return"";var e=t.getInstance(this.marketingCloudOrgId,this.visitorOptions||{});return e&&e.getMarketingCloudVisitorID?e.getMarketingCloudVisitorID():""},t.prototype.getAdBreakStartData=function(){var t=this.agent.getDataVo();return{"media.ad.podFriendlyName":t.adBreakType,"media.ad.podIndex":t.adBreakPosition,"media.ad.podSecond":t.playhead}},t.prototype.getAdItemData=function(){var t=this.agent.getDataVo();return{"media.ad.name":t.adTitle,"media.ad.id":t.videoTitle+" - "+t.adTitle,"media.ad.length":t.adDuration,"media.ad.creativeId":t.adId,"media.ad.creativeURL":t.adUrl,"media.ad.playerName":t.playerName,"media.ad.podPosition":t.adPosition}},t.prototype.getApiPath=function(t){return[t=t.replace(/^\/|\/$/g,""),"events"].join("/")},t.prototype.getPayload=function(t){var e=this.agent.getDataVo(),i={};switch(t){case"adBreakStart":i=this.getAdBreakStartData();break;case"adStart":i=this.getAdItemData()}return{eventType:t,playerTime:{playhead:e.playhead,ts:(new Date).getTime()},params:i}},t.SESSION_PATH="api/v1/sessions",t.LIVE_CONTENT_LENGTH=86400,a([s(!1)],t.prototype,"enableSSL",void 0),a([s()],t.prototype,"channel",void 0),a([s()],t.prototype,"reportSuite",void 0),a([s()],t.prototype,"trackingServer",void 0),a([s()],t.prototype,"marketingCloudOrgId",void 0),a([s()],t.prototype,"marketingCloudUserId",void 0),a([s()],t.prototype,"visitorId",void 0),a([s()],t.prototype,"devApiServer",void 0),a([s()],t.prototype,"prodApiServer",void 0),a([s()],t.prototype,"visitorOptions",void 0),t=n=a([h()],t)}(d);i.AdobeVo=R;var B=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.trackContentStart=!1,t.isStopped=!1,t}return o(t,e),t.prototype.onRegister=function(){e.prototype.onRegister.call(this),this.vo=new L(this)},t.prototype.onNotificationReceived=function(t){if(e.prototype.onNotificationReceived.call(this,t),this.vo.isOzTamOptOut())u.isDebug()&&u.logger.log(this.debugId,"OzTam OptOut");else switch(t.name){case k.ContentStart:this.trackContentStart=!0;break;case k.SeekStart:this.ozTamInstance&&this.ozTamInstance.seekBegin();break;case k.SeekEnd:this.ozTamInstance&&this.ozTamInstance.seekComplete(),this.isStopped=!0;break;case k.ContentPause:case k.BufferStart:this.isStopped=!0,this.ozTamInstance&&this.ozTamInstance.haltProgress();break;case k.ContentEnd:this.ozTamInstance&&this.ozTamInstance.complete();break;case k.ContentResume:case k.PlayheadUpdate:this.onPlayheadUpdate()}},t.prototype.onPlayheadUpdate=function(){this.isAdPlaying||(this.trackContentStart&&(this.startSession(),this.beginPlayback(),this.trackContentStart=!1),this.isStopped&&(this.isStopped=!1,this.ozTamInstance&&this.ozTamInstance.resumeProgress()))},t.prototype.startSession=function(){var t=this.vo.getConfigInfo();this.ozTamInstance=new this.OzTAMService(t.publisherId,t.vendorVersion,t.productionMode,t.verboseLogging,t.useHTTPS),this.mediaInfo=this.vo.getMediaInfo(),this.ozTamInstance&&this.ozTamInstance.startSession(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaType)},t.prototype.beginPlayback=function(){this.ozTamInstance&&this.ozTamInstance.beginPlayback(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaPositionFunction,this.vo.getPropertyDictionary(),this.mediaInfo.mediaType)},t.NAME="OzTam",t=a([p({name:"OzTAMService",type:"function"}),h()],t)}(b);i.OzTamAgent=B;var L=function(i){function t(t){var e=i.call(this,t.config.params)||this;return e.agent=t,e}return o(t,i),t.prototype.getConfigInfo=function(){return{publisherId:this.publisherId,vendorVersion:this.getVendorVersion(),productionMode:!u.debug,verboseLogging:u.debug,useHTTPS:g.isHttps()}},t.prototype.getVendorVersion=function(){var t=this.agent.getDataVo(),e=t.isMobile?"Mobile-Web":"Desktop-Web";return C.isChromecast()&&(e="Chromecast"),[this.platform,e,t.playerVersion].join("_")},t.prototype.getMediaInfo=function(){var t=this.agent.getDataVo(),e=function(){return t.playhead}.bind(this);return{mediaId:t.ozTamMediaId||t.mediaId,url:t.mediaUrl,mediaDuration:t.duration,mediaType:t.isLive?"live":"vod",mediaPositionFunction:e}},t.prototype.getPropertyDictionary=function(){var t=this.agent.getDataVo(),e={};return t.ozTamMediaId&&(e.altMediaId=t.mediaId),t.userId&&(e.demo1=t.userId),e},t.prototype.isOzTamOptOut=function(){return this.agent.getDataVo().ozTamOptOut},a([s()],t.prototype,"publisherId",void 0),a([s()],t.prototype,"platform",void 0),t=a([h()],t)}(d);i.OzTamVo=L;var w=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.onRegister=function(){e.prototype.onRegister.call(this),this.vo=new O(this)},t.prototype.onNotificationReceived=function(t){switch(e.prototype.onNotificationReceived.call(this,t),t.name){case k.ContentStart:this.sessionId||this.createSession();break;case k.AdBreakStart:this.onAdBreakStart();break;case k.AdStart:this.onAdStart();break;case k.AdEnd:this.onAdEnd();break;case k.AdBreakEnd:this.onAdBreakEnd();break;case k.BitrateChange:this.Conviva.LivePass.setBitrate(this.sessionId,this.getDataVo().currentBitrate);break;case k.SessionEnd:this.cleanUpSession();break;case k.PlayerError:this.onPlayerError()}},t.prototype.createSession=function(){if(this.cleanUpSession(),this.vo.getCastPlayerManager()){var t=this.vo.getCustomerKey();u.isDebug()?(this.Conviva.LivePass.toggleTraces(!0),this.Conviva.LivePass.initWithSettings(t,this.vo.getInitOptions())):(this.Conviva.LivePass.toggleTraces(!1),this.Conviva.LivePass.init(this.vo.customerKey)),this.playerManager=this.vo.getCastPlayerManager(),this.streamer=new this.Conviva.ConvivaCastV3StreamerProxy(this.playerManager);var e=this.vo.getContentInfo();u.isDebug()&&u.logger.log(this.streamer,e),this.sessionId=this.Conviva.LivePass.createSession(this.streamer,e,this.vo.getSessionOptions())}else u.isDebug()&&u.logger.log("playerManger not provided")},t.prototype.onAdBreakStart=function(){this.sessionId||this.createSession(),this.Conviva.LivePass.detachStreamer(this.sessionId),this.adBreakInfo=this.vo.getAdBreakInfo(),this.Conviva.LivePass.sendSessionEvent(this.sessionId,"Conviva.PodStart",this.adBreakInfo)},t.prototype.onAdBreakEnd=function(){this.adBreakInfo.podDuration&&delete this.adBreakInfo.podDuration,this.Conviva.LivePass.sendSessionEvent(this.sessionId,"Conviva.PodEnd",this.adBreakInfo),this.Conviva.LivePass.attachStreamer(this.sessionId,this.streamer)},t.prototype.onAdStart=function(){this.Conviva.LivePass.adStart(this.sessionId)},t.prototype.onAdEnd=function(){this.Conviva.LivePass.adEnd(this.sessionId)},t.prototype.onBitRateChange=function(){this.Conviva.LivePass.setBitrate(this.sessionId,this.getDataVo().currentBitrate)},t.prototype.onPlayerError=function(){var t=this.vo.getConvivaError();this.Conviva.LivePass.reportError(t.sessionId,t.message,t.type),this.getDataVo().errorFatal&&(this.Conviva.LivePass.cleanupSession(this.sessionId),this.createSession())},t.prototype.cleanUpSession=function(){u.isDebug()&&u.logger.log(this.debugId,"LivePass.cleanUpSession"),this.sessionId&&this.Conviva?(this.Conviva.LivePass.cleanupSession(this.sessionId),this.sessionId=""):u.isDebug()&&u.logger.log(this.debugId,"Conviva not found")},t.NAME="ConvivaCast",t=a([p({name:"Conviva",type:"function"}),h()],t)}(b);i.ConvivaCastAgent=w;var O=function(i){function t(t){var e=i.call(this,t.config.params)||this;return e.agent=t,e}return o(t,i),t.prototype.getCustomerKey=function(){return u.isDebug()?this.testCustomerKey:this.customerKey},t.prototype.getInitOptions=function(){var t=u.debug?this.testServerUrl:this.prodServerUrl;return-1===t.search(/^http/)&&(t=g.getProtocol()+t),{gatewayUrl:t}},t.prototype.getSessionOptions=function(){var t;return(t={})[this.agent.Conviva.LivePass.OPTION_EXTERNAL_BITRATE_REPORTING]=!0,t},t.prototype.getContentInfo=function(){var t=this.agent.getDataVo(),e=new this.agent.Conviva.ConvivaContentInfo;e.playerName=t.playerName,e.streamUrl=t.mediaUrl,e.assetName=t.videoTitle,e.duration=t.duration,e.defaultReportingBitrateKbps=t.currentBitrate,e.defaultReportingResource=t.cdn,e.encodedFps=t.playbackFramerate,e.isLive=t.isLive,e.viewerId=t.userId;var i={accessType:t.userStatus||"sb|0",contentId:t.mediaId||"N/A",contentType:t.isLive?"Live":"VOD",isEpisode:t.episodeFlag.toString(),Partner_ID:t.partner,Player_Version:t.playerVersion,seriesTitle:t.seriesTitle,episodeTitle:this.getEpisodeTitle(t),app:t.playerName,appVersion:t.playerName+" "+t.playerVersion,appRegion:t.userCountry||"us",drm:t.drmEnabled.toString(),drmType:t.drmType.toString()||"N/A",connectionType:t.userConnectionType||"unknown",winDimension:g.getScreenSize(),showId:t.contextData.showSeriesId||""};return e.tags=this.dataToString(i),e},t.prototype.getEpisodeTitle=function(t){var e=t.videoTitle||t.episodeTitle;return t.isLive?e:(-1<e.search(/\w+.*-.*\w+/)&&(e=e.split("-")[1]),e.replace(/^\s+|\s+$/g,""))},t.prototype.getAdBreakInfo=function(){var t=this.agent.getDataVo();return this.dataToString({podDuration:t.adBreakDuration,podIndex:t.adBreakPosition,podPosition:t.adBreakType+"-roll"})},t.prototype.getConvivaError=function(){var t=this.agent.getDataVo(),e=this.agent.Conviva.StreamerError;return this.dataToString({sessionId:this.agent.sessionId,message:[t.errorType,t.errorMessage].join(":"),type:t.errorFatal?e.SEVERITY_FATAL:e.SEVERITY_WARNING})},t.prototype.getCastPlayerManager=function(){return this.agent.getDataVo().playerManager},a([s()],t.prototype,"customerKey",void 0),a([s()],t.prototype,"testCustomerKey",void 0),a([s()],t.prototype,"testServerUrl",void 0),a([s()],t.prototype,"prodServerUrl",void 0),t=a([h()],t)}(d);i.ConvivaCastVo=O},{}]},{},[1])(1)});